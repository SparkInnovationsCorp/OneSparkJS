(global=>{const OneSparkJs={};OneSparkJs.Application=(()=>{let t=0,s=!1,n=null,h=[];class i{constructor(t=0){h.push({Instance:this,Priority:t}),h.sort((t,e)=>t.Priority-e.Priority)}}const l=async()=>{var t=await $1S.getTypeAsync("MainApp");t?((n=new t).onStart&&n.onStart(),e()):console.error("Application not defined.")};const e=()=>{t=0,s=!0,window.requestAnimationFrame(r)},r=e=>{let i=e-t;n&&(n.onTick&&n.onTick(e,i),h.forEach(t=>{t.Instance.handleTickEvent&&t.Instance.handleTickEvent(e,i)}),h.forEach(t=>{t.Instance.handlePostTickEvent&&t.Instance.handlePostTickEvent(e,i)}),n.onPostTick)&&n.onPostTick(e,i),t=e,s&&window.requestAnimationFrame(r)},o=()=>{s=!1};return{ExtensionType:i,version:"1.0.0",load:(t,i={},s=null)=>{var e,n,r,o,a;t.endsWith("/")||(t+="/"),e=t,n=i,r=()=>{console.log("All extensions loaded."),$1S.include(t+"main.js",null,(t,e)=>{t?(i.autoStart&&l(),s&&s()):console.error(e)})},o=h.length,a=0,h.forEach(t=>{t.Instance.onLoad&&t.Instance.onLoad(e,n,()=>{++a===o&&r()})})},start:l,stop:async()=>{n.onStop&&n.onStop(),o(),$1S.Renderer.Graphics.clear(),OneStartJS.Stage.reset()},get:()=>n,tick:r,startClock:e,stopClock:o,registerExtension:(t,e=0)=>{t instanceof i?(h.push({Instance:t,Priority:e}),h.sort((t,e)=>t.Priority-e.Priority)):console.error("Error: obj is not an instance of ApplicationExtensionType")}}})(),OneSparkJs.Helper={newId:()=>{let e="";for(let t=0;t<32;t++)e+=Math.floor(16*Math.random()).toString(16),7!==t&&11!==t&&15!==t&&19!==t||(e+="-");return e}},OneSparkJs.Module=(()=>{let filesLoaded=[],dependencies=[],types=[];const include=(files,parent=null,callback=null)=>{if("string"==typeof files)files=[files];else if(!Array.isArray(files))return void("function"==typeof callback&&callback(!1,"Error: 'files' parameter must be an array or a string"));const parentFilePath=null==parent?getParentFilePath():parent,parentPath=parentFilePath.replace(/\/[^\/]+$/,"")+"/",loadScript=file=>{const url=resolveUrl(file,parentPath),dependencyExists=dependencies.some(t=>t.Parent===parentFilePath&&t.Child===file);var xhr;dependencyExists||dependencies.push({Parent:parentFilePath,Child:file}),filesLoaded.includes(file)||(xhr=new XMLHttpRequest,xhr.open("GET",url,!0),xhr.onload=function(){if(200===xhr.status){var script=xhr.responseText,script=modifyIncludeCalls(script,url);script="async function factory() {\n"+script+"\n}\nfactory();";try{eval(script),loadedCount++,filesLoaded.includes(file)||filesLoaded.push(file),checkIfAllLoaded()}catch(e){console.error(`Error evaluating script in ${url}:`,e),errorCount++,checkIfAllLoaded()}}},xhr.onerror=function(){console.error(`Error evaluating script in ${url}:`,xhr.statusText),errorCount++,checkIfAllLoaded()},xhr.send())};let loadedCount=0,errorCount=0,errorMessages=[];const checkIfAllLoaded=()=>{var t,e;loadedCount+errorCount===files.length&&(e=(t=0===errorCount)?"All files loaded successfully":"Errors loading files: "+errorMessages.join("; "),callback)&&callback(t,e)},modifyIncludeCalls=(i,s)=>{var n="$1S.include(";let r=0;for(;;){var o=i.indexOf(n,r),a=i.indexOf("$1S.import(",r),h=-1;if(-1===o&&-1===a)break;if(-1!=o&&(-1==a||-1!=a&&o<a)&&(h=o),-1===(h=-1!=a&&(-1==o||-1!=o&&a<o)?a:h))break;let t=1,e=h+n.length;for(;0<t&&e<i.length;)"("===i.charAt(e)?t++:")"===i.charAt(e)&&t--,e++;if(0!==t)break;o=i.slice(h,e).slice(0,-1)+`, "${s}")`;i=i.slice(0,h)+o+i.slice(e),r=h+o.length}return i};files&&files.length?files.forEach(loadScript):"function"==typeof callback&&callback(!0,"No files to load")},importType=async(t,e,i=null)=>(include(e,i),getTypeAsync(t)),registerType=(t,e)=>{types.find(t=>t.Alias===e)||types.push({Type:t,Alias:e})},getTypeAsync=async e=>{for(;;){var t=types.find(t=>t.Alias===e);if(t)return t.Type;await new Promise(t=>setTimeout(t,100))}},getType=e=>{var t=types.find(t=>t.Alias===e);if(t)return t.Type;throw new Error(`Type with alias ${e} not found`)},getParentFilePath=()=>{var t=((new Error).stack||"").split("\n")[3]||"",e=t.indexOf("/",t.indexOf("//")+2),i=t.indexOf(":",e);return-1!==e&&-1!==i?t.substring(e,i):""},resolveUrl=(t,e)=>{return t.toLowerCase().startsWith("http://")||t.toLowerCase().startsWith("https://")||(e=new URL(e,window.location.href),t=new URL(t,e).pathname),t};return{include:include,importType:importType,registerType:registerType,getType:getType,getTypeAsync:getTypeAsync}})(),global.$1S={Application:{ExtensionType:OneSparkJs.Application.ExtensionType,load:OneSparkJs.Application.load,start:OneSparkJs.Application.start,startClock:OneSparkJs.Application.startClock,stopClock:OneSparkJs.Application.stopClock,get:OneSparkJs.Application.get,registerExtension:OneSparkJs.Application.registerExtension},Assets:{},Helper:{newId:OneSparkJs.Helper.newId},import:OneSparkJs.Module.importType,include:OneSparkJs.Module.include,registerType:OneSparkJs.Module.registerType,getType:OneSparkJs.Module.getType,getTypeAsync:OneSparkJs.Module.getTypeAsync}})("undefined"!=typeof window?window:global),(t=>{var e={};e.Assets=(()=>{class t extends $1S.Application.ExtensionType{assetSheet={audio:[],images:[],loops:[],layouts:[]};constructor(){super(100)}onLoad=(t,e,i)=>{try{var s=t+"assets.json",n=new XMLHttpRequest;n.open("GET",s,!0),n.onload=()=>{var t;200===n.status&&(t=JSON.parse(n.responseText),Array.isArray(t.audio)&&(this.assetSheet.audio=t.audio,$1S.Audio)&&this.assetSheet.audio.forEach(function(t){$1S.Audio.preload(t.path)}),Array.isArray(t.images)&&t.images.forEach(t=>{this.preloadImage(t)}),Array.isArray(t.layouts))&&(this.assetSheet.layouts=t.layouts),i&&i()},n.onerror=()=>{console.error("Error loading asset sheet",n.statusText),i&&i()},n.send()}catch(t){console.log("Error loading asset sheet",t),i&&i()}};getAudio=e=>{for(let t=0;t<this.assetSheet.audio.length;t++)if(this.assetSheet.audio[t].name===e)return this.assetSheet.audio[t];return null};getImage=e=>{for(let t=0;t<this.assetSheet.images.length;t++)if(this.assetSheet.images[t].name===e)return this.assetSheet.images[t];return null};getSpriteLoop=e=>{for(let t=0;t<this.assetSheet.loops.length;t++)if(this.assetSheet.loops[t].group===e)return this.assetSheet.loops[t];return null};getTileset=e=>{for(let t=0;t<this.assetSheet.layouts.length;t++)if(this.assetSheet.layouts[t].name===e)return this.assetSheet.layouts[t];return null};preloadImage=t=>{var e;t.path&&((e=new Image).src=t.path,e.onload=()=>{var h=document.createElement("canvas"),l=h.getContext("2d");h.width=e.width,h.height=e.height,l.drawImage(e,0,0,e.width,e.height),(t.clipPaths&&0<t.clipPaths.length?(t.clipPaths.forEach(t=>{for(var e=1/0,i=-1/0,s=1/0,n=-1/0,r=0;r<t.clipPath.length;r++)e=Math.min(e,t.clipPath[r].x),i=Math.max(i,t.clipPath[r].x),s=Math.min(s,t.clipPath[r].y),n=Math.max(n,t.clipPath[r].y);var o=document.createElement("canvas"),a=(o.width=i-e,o.height=n-s,o.getContext("2d"));l.strokeStyle="red",l.lineWidth=5,l.beginPath(),l.moveTo(t.clipPath[0].x,t.clipPath[0].y);for(r=1;r<t.clipPath.length;r++)l.lineTo(t.clipPath[r].x,t.clipPath[r].y);l.closePath(),l.clip(),a.drawImage(h,-e,-s),t.Canvas=o,t.CanvasContext=a,t.name&&this.assetSheet.images.push(t)}),this.assetSheet.loops):(t.Canvas=h,t.CanvasContext=l,this.assetSheet.images)).push(t)})}}return{Ext:new t}})(),t.$1S.Assets={getAudio:e.Assets.Ext.getAudio,getImage:e.Assets.Ext.getImage,getSpriteLoop:e.Assets.Ext.getSpriteLoop,getTileset:e.Assets.Ext.getTileset}})("undefined"!=typeof window?window:global),(t=>{const n={InputEventTypes:{KEY_DOWN:"keydown",KEY_UP:"keyup",MOUSE_MOVE:"mousemove",MOUSE_UP:"mouseup",MOUSE_CLICK:"mouseclick",MOUSE_CLICK_OUT:"mouseclickout",MOUSE_DOUBLE_CLICK:"mousedoubleclick",RIGHT_MOUSE_CLICK:"rightmouseclick",CENTER_MOUSE_CLICK:"centermouseclick",RIGHT_MOUSE_UP:"rightmouseup",CENTER_MOUSE_UP:"centermouseup",MOUSE_SCROLL_UP:"mousescrollup",MOUSE_SCROLL_DOWN:"mousescrolldown",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_CANVAS_ENTER:"mousecanvasenter",MOUSE_CANVAS_LEAVE:"mousecanvasleave",TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",TOUCH_CANCEL:"touchcancel",SWIP_LEFT:"swipeleft",SWIPE_RIGHT:"swiperight",TAP:"tap",TAP_OUT:"tapout",DOUBLE_TAP:"tap",PINCH:"pinch",EXPAND:"expand",ROTATE:"rotate",SHAKE:"shake",DEVICE_ORIENTATION:"deviceorientation",DEVICE_MOTION:"devicemotion",VISIBILITY_CHANGE:"visibilitychange"},IO:{loadJSON:(t,e)=>{const i=new XMLHttpRequest;i.overrideMimeType("application/json"),i.open("GET",t,!0),i.onreadystatechange=function(){4===i.readyState&&200===i.status&&e(JSON.parse(i.responseText))},i.send(null)}}};n.Inputs=(()=>{class t extends $1S.Application.ExtensionType{swipeStartX=null;swipeStartT=null;swipeThreshold=50;initialDistance=null;initialAngle=null;pinchThreshold=10;shakeHandlers=[];lastShakeTime=0;shakeThreshold=15;shakeTimeout=1e3;tapTimeout=null;doubleTapTimeout=null;doubleTapThreshold=300;tapThreshold=200;handles={};constructor(){super(0)}onLoad=(t,e,i)=>{e.canvas&&((e=document.getElementById(e.canvas)).addEventListener(n.InputEventTypes.MOUSE_MOVE,this.mouseMoveEvent),e.addEventListener("mousedown",this.mouseDownEvent),e.addEventListener(n.InputEventTypes.MOUSE_UP,this.mouseUpEvent),e.addEventListener("wheel",this.mouseScrollEvent),e.addEventListener("mouseenter",this.mouseCanvasEnterEvent),e.addEventListener("mouseleave",this.mouseCanvasLeaveEvent),e.addEventListener(n.InputEventTypes.TOUCH_START,this.touchStartEvent),e.addEventListener(n.InputEventTypes.TOUCH_MOVE,this.touchMoveEvent),e.addEventListener(n.InputEventTypes.TOUCH_END,this.touchEndEvent),e.addEventListener(n.InputEventTypes.TOUCH_CANCEL,this.touchCancelEvent)),window.addEventListener(n.InputEventTypes.KEY_DOWN,this.keyDownEvent),window.addEventListener(n.InputEventTypes.KEY_UP,this.keyUpEvent),window.addEventListener(n.InputEventTypes.DEVICE_ORIENTATION,this.deviceOrientationEvent),window.addEventListener(n.InputEventTypes.DEVICE_MOTION,this.deviceMotionEvent),document.addEventListener(n.InputEventTypes.VISIBILITY_CHANGE,this.visibilityChangeEvent),i()};keyUpEvent=e=>{if(this.handles[n.InputEventTypes.KEY_UP]){this.handles[n.InputEventTypes.KEY_UP].sort((t,e)=>t.priority-e.priority);for(let t=0;t<this.handles[n.InputEventTypes.KEY_UP].length;t++)if(this.handles[n.InputEventTypes.KEY_UP][t].eventHandler(e))break}};keyDownEvent=e=>{if(this.handles[n.InputEventTypes.KEY_DOWN]){this.handles[n.InputEventTypes.KEY_DOWN].sort((t,e)=>t.priority-e.priority);for(let t=0;t<this.handles[n.InputEventTypes.KEY_DOWN].length;t++)if(this.handles[n.InputEventTypes.KEY_DOWN][t].eventHandler(e))break}};mouseMoveEvent=t=>{this.handleMouseEvent(t,n.InputEventTypes.MOUSE_MOVE)};mouseUpEvent=t=>{switch(t.button){case 0:this.handleMouseEvent(t,n.InputEventTypes.MOUSE_UP);break;case 1:this.handleMouseEvent(t,n.InputEventTypes.CENTER_MOUSE_UP);break;case 2:this.handleMouseEvent(t,n.InputEventTypes.RIGHT_MOUSE_UP)}};mouseDownEvent=t=>{switch(t.button){case 0:this.handleMouseEvent(t,n.InputEventTypes.MOUSE_CLICK);break;case 1:this.handleMouseEvent(t,n.InputEventTypes.CENTER_MOUSE_CLICK);break;case 2:this.handleMouseEvent(t,n.InputEventTypes.RIGHT_MOUSE_CLICK)}};mouseCanvasEnterEvent=t=>{this.handleGenericEvent(t,n.InputEventTypes.MOUSE_CANVAS_ENTER)};mouseCanvasLeaveEvent=t=>{this.handleGenericEvent(t,n.InputEventTypes.MOUSE_CANVAS_LEAVE)};mouseScrollEvent=t=>{0<t.deltaY?this.handleMouseEvent(t,n.InputEventTypes.MOUSE_SCROLL_DOWN):this.handleMouseEvent(t,n.InputEventTypes.MOUSE_SCROLL_UP)};touchStartEvent=t=>{1===t.touches.length?(this.swipeStartX=t.touches[0].clientX,this.swipeStartT=t.touches[0].clientY):2===t.touches.length&&(this.initialDistance=calculateDistance(t.touches[0],t.touches[1]),this.this.initialAngle=calculateAngle(t.touches[0],t.touches[1])),this.handleTouchEvent(t,n.InputEventTypes.TOUCH_START)};touchMoveEvent=t=>{var e,i;2===t.touches.length&&(null!==this.initialDistance&&(e=calculateDistance(t.touches[0],t.touches[1]),Math.abs(e-this.initialDistance)>this.pinchThreshold)&&(e>this.initialDistance?this.handlePinchEvent(t,n.InputEventTypes.EXPAND):this.handlePinchEvent(t,n.InputEventTypes.PINCH),this.initialDistance=e),null!==this.initialAngle)&&(i=(e=calculateAngle(t.touches[0],t.touches[1]))-this.initialAngle,this.handleRotationEvent(t,n.InputEventTypes.ROTATE,i),this.initialAngle=e),this.handleTouchEvent(t,n.InputEventTypes.TOUCH_MOVE)};touchEndEvent=t=>{var e,i;0===t.touches.length&&null===this.initialDistance&&null===this.initialAngle&&(null!==this.doubleTapTimeout?(clearTimeout(this.doubleTapTimeout),this.doubleTapTimeout=null,this.handleTapEvent(t,n.InputEventTypes.DOUBLE_TAP)):this.tapTimeout=setTimeout(()=>{this.handleTapEvent(t,n.InputEventTypes.TAP),this.doubleTapTimeout=setTimeout(()=>{this.doubleTapTimeout=null},this.doubleTapThreshold)},this.tapThreshold)),null!==this.swipeStartX&&null!==this.swipeStartT&&(e=(i=t.changedTouches[0]).clientX-this.swipeStartX,i=i.clientY-this.swipeStartT,Math.abs(e)>Math.abs(i))&&Math.abs(e)>this.this.swipeThreshold&&(0<e?this.handleSwipeEvent(t,n.InputEventTypes.SWIP_RIGHT):this.handleSwipeEvent(t,n.InputEventTypes.SWIP_LEFT)),this.swipeStartX=null,this.swipeStartT=null,this.initialDistance=null,this.initialAngle=null,this.handleTouchEvent(t,n.InputEventTypes.TOUCH_END)};touchCancelEvent=t=>{this.handleTouchEvent(t,n.InputEventTypes.TOUCH_CANCEL)};deviceOrientationEvent=t=>{this.handleDeviceEvent(t,n.InputEventTypes.DEVICE_ORIENTATION)};deviceMotionEvent=t=>{var e,i;this.handleDeviceEvent(t,n.InputEventTypes.DEVICE_MOTION),t.accelerationIncludingGravity&&({x:t,y:e,z:i}=t.accelerationIncludingGravity,Math.sqrt(t*t+e*e+i*i)>this.shakeThreshold)&&Date.now()-this.lastShakeTime>this.shakeTimeout&&(this.lastShakeTime=Date.now(),this.handleShakeEvent())};visibilityChangeEvent=()=>{var t=document.hidden;this.handleVisibilityChange(t)};handleGenericEvent=(e,i)=>{if(this.handles[i]){this.handles[i].sort((t,e)=>t.priority-e.priority);for(let t=0;t<this.handles[i].length;t++)if(this.handles[i][t].eventHandler(e))break}};handleMouseEvent=(e,i)=>{if(this.handles[i]){this.handles[i].sort((t,e)=>t.priority-e.priority);for(let t=0;t<this.handles[i].length;t++){var s=this.handles[i][t];if(s.region&&(e.clientX<s.region.x1||e.clientX>s.region.x2||e.clientY<s.region.y1||e.clientY>s.region.y2))i==n.InputEventTypes.MOUSE_MOVE&&s.isOver&&(s.isOver=!1,this.handleGenericEvent(e,n.InputEventTypes.MOUSE_LEAVE)),i==n.InputEventTypes.MOUSE_CLICK&&(s.isOver=!1,this.handleGenericEvent(e,n.InputEventTypes.MOUSE_CLICK_OUT));else if(i!=n.InputEventTypes.MOUSE_MOVE||s.isOver||(s.isOver=!0,this.handleGenericEvent(e,n.InputEventTypes.MOUSE_ENTER)),s.eventHandler(e))break}}};handleTouchEvent=(i,s)=>{if(this.handles[s]){this.handles[s].sort((t,e)=>t.priority-e.priority);for(let t=0;t<this.handles[s].length;t++){var n=this.handles[s][t];let e=!1;for(let t=0;t<i.touches.length;t++){var r=i.touches[t];if(r.clientX>=n.region.x1&&r.clientX<=n.region.x2&&r.clientY>=n.region.y1&&r.clientY<=n.region.y2){e=!0;break}}if(e)if(n.eventHandler(i))break}}};handleTapEvent=(e,i)=>{if(this.handles[i]){this.handles[i].sort((t,e)=>t.priority-e.priority);for(let t=0;t<this.handles[i].length;t++){var s=this.handles[i][t];if(s.region&&(e.clientX<s.region.x1||e.clientX>s.region.x2||e.clientY<s.region.y1||e.clientY>s.region.y2))i==n.InputEventTypes.TAP&&(s.isOver=!1,this.handleGenericEvent(e,n.InputEventTypes.TAP_OUT));else if(s.eventHandler(e))break}}};handleSwipeEvent=(e,i)=>{if(this.handles[i]){this.handles[i].sort((t,e)=>t.priority-e.priority);for(let t=0;t<this.handles[i].length;t++){var s=this.handles[i][t];if(!s.region||!(e.clientX<s.region.x1||e.clientX>s.region.x2||e.clientY<s.region.y1||e.clientY>s.region.y2))if(s.eventHandler(e))break}}};handlePinchEvent=(e,i)=>{if(this.handles[i]){this.handles[i].sort((t,e)=>t.priority-e.priority);for(let t=0;t<this.handles[i].length;t++){var s=this.handles[i][t];if(!s.region||!(e.clientX<s.region.x1||e.clientX>s.region.x2||e.clientY<s.region.y1||e.clientY>s.region.y2))if(s.eventHandler(e))break}}};handleRotationEvent=(e,i,s)=>{if(this.handles[i]){this.handles[i].sort((t,e)=>t.priority-e.priority);for(let t=0;t<this.handles[i].length;t++){var n=this.handles[i][t];if(!n.region||!(e.clientX<n.region.x1||e.clientX>n.region.x2||e.clientY<n.region.y1||e.clientY>n.region.y2))if(n.eventHandler(e,s))break}}};handleDeviceEvent=(e,i)=>{if(this.handles[i]){this.handles[i].sort((t,e)=>t.priority-e.priority);for(let t=0;t<this.handles[i].length;t++)if(this.handles[i][t].eventHandler(e))break}};handleShakeEvent=()=>{if(this.handles[n.InputEventTypes.SHAKE]){this.handles[n.InputEventTypes.SHAKE].sort((t,e)=>t.priority-e.priority);for(let t=0;t<this.handles[n.InputEventTypes.SHAKE].length;t++)if(this.handles[n.InputEventTypes.SHAKE][t].eventHandler())break}};handleVisibilityChange=e=>{if(this.handles[n.InputEventTypes.VISIBILITY_CHANGE]){this.handles[n.InputEventTypes.VISIBILITY_CHANGE].sort((t,e)=>t.priority-e.priority);for(let t=0;t<this.handles[n.InputEventTypes.VISIBILITY_CHANGE].length;t++)if(this.handles[n.InputEventTypes.VISIBILITY_CHANGE][t].eventHandler({hidden:e}))break}};attach=(t,e,i,s=100,n=null)=>{this.handles[t]||(this.handles[t]=[]);e={source:e,eventHandler:i,priority:s||0,isOver:!1,region:n};return this.handles[t].push(e),e};release=e=>{for(const t in this.handles)this.handles.hasOwnProperty(t)&&(this.handles[t]=this.handles[t].filter(t=>t.source!==e))};clear=t=>{this.handles={}};calculateDistance=(t,e)=>{var i=e.clientX-t.clientX,e=e.clientY-t.clientY;return Math.sqrt(i*i+e*e)};calculateAngle=(t,e)=>{var i=e.clientX-t.clientX,e=e.clientY-t.clientY;return Math.atan2(e,i)}}return{Ext:new t}})(),t.$1S.IO={Input:{EventType:n.InputEventTypes,attach:n.Inputs.Ext.attach,release:n.Inputs.Ext.release,clear:n.Inputs.Ext.clear},loadJSON:n.IO.loadJSON}})("undefined"!=typeof window?window:global),(t=>{var e={};e.Audio=(()=>{class t extends $1S.Application.ExtensionType{audioCache=new Map;activeAudios=new Set;constructor(){super(0)}onLoad=(t,e,i)=>{i()};playAudio=(t,e=!1,i=1)=>{var t=$1S.Assets.getAudio(t);null!=t&&(t=t.path,t=this.getAudioElement(t),this.activeAudios.has(t)?t.currentTime=0:this.activeAudios.add(t),e&&(t.loop=!0),1!==i&&(t.volume=i),t.play())};stopAudio=t=>{var t=$1S.Assets.getAudio(t);null!=t&&(t=t.path,t=this.audioCache.get(t))&&this.activeAudios.has(t)&&(t.pause(),t.currentTime=0,this.activeAudios.delete(t))};stopAllAudios=()=>{this.activeAudios.forEach(t=>{t.pause(),t.currentTime=0,this.activeAudios.delete(t)})};preloadAudio=t=>{this.getAudioElement(t)};getAudioElement=t=>{var e;return this.audioCache.has(t)?this.audioCache.get(t):(e=new Audio(t),this.audioCache.set(t,e),e)}}return{Ext:new t}})(),t.$1S.Audio={preload:e.Audio.Ext.preloadAudio,play:e.Audio.Ext.playAudio,stop:e.Audio.Ext.stopAudio,stopAll:e.Audio.Ext.stopAllAudios}})("undefined"!=typeof window?window:global),(t=>{const l={};l.Renderer=(()=>{const s={Center:0,UpperLeft:1,UpperRight:2,LowerLeft:3,LowerRight:4},e={ByPriority:0,ByDepth:1};class t{constructor(t=0){this.id=$1S.Helper.newId(),this.stageProps=[],this.sortBy?this.setRenderSort(this.sortBy):this.setRenderSort(e.ByPriority)}setRenderSort=t=>{t==e.ByPriority&&(this.sortBy=l.Renderer.SortByTypes.ByPriority),t==e.ByDepth&&(this.sortBy=l.Renderer.SortByTypes.ByDepth)};registerProp=(t,e={},i=1e5)=>{if(t instanceof n)return this.stageProps.push({Instance:t,Properties:e,Priority:i}),this.sortBy.sortOnRegister&&this.stageProps.sort(this.sortBy.compare),this.registerProp;throw new Error("Not a StagePropType component.")};getProp=e=>{var t=this.stageProps.find(t=>t.Instance.id===e);return t?t.Instance:null};destroyProp=e=>{var t=this.stageProps.findIndex(t=>t.Instance.id===e);return-1!==t&&(this.stageProps[t].onDestroy&&this.stageProps[t].onDestroy(),this.stageProps.splice(t,1),!0)};clearProps=()=>{for(var t=0;t<this.stageProps.length;t++)this.stageProps[t].onDestroy&&this.stageProps[t].onDestroy();this.stageProps[t]=[]};raiseTickEvent(t,e){this.onTick&&this.onTick(t,e);for(var i=0;i<this.stageProps.length;i++)this.stageProps[i].Instance.raiseTickEvent(t,e)}raiseRenderEvent(t){if(this.onDraw&&this.onDraw(t),0<this.stageProps.length){this.sortBy.sortOnRender&&this.stageProps.sort(this.sortBy.compare);for(var e=0;e<this.stageProps.length;e++)this.stageProps[e].Instance.raiseRenderEvent&&this.stageProps[e].Instance.raiseRenderEvent(t)}this.onPostDraw&&this.onPostDraw(t)}raiseResizeEvent(t,e){this.onResize&&this.onResize(t,e);for(var i=0;i<this.stageProps.length;i++)this.stageProps[i].Instance.raiseResizeEvent(this.width,this.height)}raiseDisposeEvent(){if(0<this.stageProps.length)for(var t=0;t<this.stageProps.length;t++)this.stageProps[t].Instance.raiseDisposeEvent&&this.stageProps[t].Instance.raiseDisposeEvent();this.onDispose&&this.onDispose()}raiseShowStageEvent(){if(0<this.stageProps.length)for(var t=0;t<this.stageProps.length;t++)this.stageProps[t].Instance.raiseShowStageEvent&&this.stageProps[t].Instance.raiseShowStageEvent();this.onShowStage&&this.onShowStage()}raiseHideStageEvent(){if(0<this.stageProps.length)for(var t=0;t<this.stageProps.length;t++)this.stageProps[t].Instance.raiseHideStageEvent&&this.stageProps[t].Instance.raiseHideStageEvent();this.onHideStage&&this.onHideStage()}}class i extends t{constructor(t,e={}){super();var i=$1S.Renderer.Graphics.getSize();this.width=i.width,this.height=i.height,this.name=t,$1S.Renderer.register(t,this),this.onInit&&this.onInit(e)}raiseRenderEvent=t=>{t.clearRect(0,0,this.width,this.height),super.raiseRenderEvent(t),$1S.Renderer.Graphics.publish()};raiseResizeEvent(t,e){this.width=t,this.height=e,super.raiseResizeEvent(t,e)}}class n extends t{constructor(t={},e=!1){super(),this.x=t.x||0,this.y=t.y||0,this.z=t.z||0,this.width=t.width||100,this.height=t.height||100,this.rotation=t.rotation||0,this.isVisible=t.isShown||!0,this.alignOn=t.alignOn||s.Center;var i=$1S.Renderer.Graphics.getSize();this.screenWidth=i.width,this.screenHeight=i.height,this.workCanvas=document.createElement("canvas"),this.workCanvas.width=this.width,this.workCanvas.height=this.height,this.workContext=this.workCanvas.getContext("2d"),!e&&this.onInit&&this.onInit(t)}getRegion(){switch(this.alignOn){case s.Center:return{x1:this.x-this.width/2,y1:this.y-this.height/2,x2:this.x+this.width/2,y2:this.y+this.height/2};case s.UpperLeft:return{x1:this.x,y1:this.y,x2:this.x+this.width,y2:this.y+this.height};case s.UpperRight:return{x1:this.x-this.width,y1:this.y,x2:this.x,y2:this.y+this.height};case s.LowerLeft:return{x1:this.x,y1:this.y-this.height,x2:this.x+this.width,y2:this.y};case s.LowerRight:return{x1:this.x-this.width,y1:this.y-this.height,x2:this.x,y2:this.y};default:return{x1:this.x,y1:this.y,x2:this.x+this.width,y2:this.y+this.height}}}show(){this.isVisible=!0}hide(){this.isVisible=!1}raiseRenderEvent=t=>{if(this.isVisible){if(null==t)throw new Error("Canvas context is missing.");if(this.onDraw&&this.onDraw(this.workContext),super.raiseRenderEvent(this.workContext),this.onPostDraw&&this.onPostDraw(this.workContext),0!=this.rotation){var e=Math.PI/180*this.rotation;t.save(),t.translate(this.x,this.y),t.rotate(e),t.translate(-this.width/2,-this.height/2),t.drawImage(this.workCanvas,0,0),t.restore()}else switch(this.alignOn){case s.Center:t.drawImage(this.workCanvas,this.x-this.width/2,this.y-this.height/2);break;case s.UpperLeft:t.drawImage(this.workCanvas,this.x,this.y);break;case s.UpperRight:t.drawImage(this.workCanvas,this.x,this.y-this.height);break;case s.LowerLeft:t.drawImage(this.workCanvas,this.x-this.width,this.y);break;case AlignOn.LowerRight:t.drawImage(this.workCanvas,this.x-this.width,this.y-this.height);break;default:t.drawImage(this.workCanvas,this.x-this.width/2,this.y-this.height/2)}}}}class r extends n{constructor(t={}){super(t),this.framesPerSecond=t.framesPerSecond||12,this.activeLoop=null,this.spriteLoop={},this.frame=t.frameStart||0,this.framesPerSecond=t.framesPerSecond||12,this.frameTime=1e3/this.framesPerSecond,this.sizeChange=!1,this.renderedFrame=-1,this.lastFrameUpdateTime=0,t.groupName&&this.loadGroup(t.groupName),t.imageName&&this.loadImage(t.imageName,1)}loadGroup(t){if(!t)throw new Error("A sprite group is required.");var e=$1S.Assets.getSpriteLoop(t);if(!e)throw new Error(`Sprite group ${t} not found.`);this.adjustSize(e),this.spriteLoop[t]=e,this.activeLoop||(this.activeLoop=e)}loadImage(t,e){if(!t)throw new Error("An image is required.");var i=$1S.Assets.getImage(t);if(!i)throw new Error(`Sprite image ${t} not found.`);for(var s={group:t,clipPaths:[]},n=0;n<e;n++)s.clipPaths.push({Canvas:i.Canvas,CanvasContext:i.CanvasContext});this.adjustSize(s),this.spriteLoop[t]=s,this.activeLoop||(this.activeLoop=s)}adjustSize(t){for(var e=!1,i=0;i<t.clipPaths.length;i++)this.width<t.clipPaths[i].Canvas.width&&(this.width=t.clipPaths[i].Canvas.width,e=!0),this.height<t.clipPaths[i].Canvas.height&&(this.height=t.clipPaths[i].Canvas.height,e=!0);e&&(this.workCanvas.width=this.width,this.workCanvas.height=this.height,this.workContext=this.workCanvas.getContext("2d"))}show(t){var e=this.spriteLoop[t];e||(this.loadGroup(t),e=this.spriteLoop[t]),this.frame=0,this.activeLoop=e}onTick(t,e){this.activeLoop&&this.isVisible&&1<this.activeLoop.clipPaths.length&&t-this.lastFrameUpdateTime>=this.frameTime&&(this.lastFrameUpdateTime=t,this.frame++,this.frame>=this.activeLoop.clipPaths.length)&&(this.frame=0)}onDraw(t){var e;this.activeLoop&&this.isVisible&&this.frame!=this.renderedFrame&&(e=this.activeLoop.clipPaths[this.frame].Canvas,this.activeLoop.clipPaths[this.frame].CanvasContext,t.clearRect(0,0,this.workCanvas.width,this.workCanvas.height),t.drawImage(e,0,0),this.renderedFrame=this.frame)}}class o extends n{constructor(t,e={}){if(super(e),!t)throw new Error("Layout name invalid.");this.layoutName=t,this.tiles=[],this.initialize()}initialize(){var t=$1S.Assets.getTileset(this.layoutName);if(!t)throw new Error(`Layout ${layoutName} not found.`);for(var e=0;e<t.tiles.length;e++){var i=t.tiles[e],i=new $1S.Renderer.Type.SpriteType({imageName:i.imageName,groupName:i.groupName,framesPerSecond:i.frameRate||0,framesStart:i.frameStart||0,x:i.x||0,y:i.y||0,alignOn:i.alignOn||$1S.Renderer.Type.AlignOn.UpperLeft});this.registerProp(i)}}}class a extends $1S.Application.ExtensionType{stages={};activeStageName=null;constructor(){super(0)}onLoad=(t,e,i)=>{e.canvas&&l.Graphics.initialize(e.canvas,e.fullWindow),i()};getActiveName=()=>this.activeStageName;register=(t,e=null)=>{if(!t)throw new Error("Invalid stage name.");if(this.stages[t])throw new Error("Stage already defined.");if(null==e||!(e instanceof i))throw new Error("Not a StageType.");this.stages[t]={Name:t,Instance:e,SavedState:null}};raiseResizeEvent=(t,e)=>{var i;null!=this.activeStageName&&(i=this.stages[this.activeStageName])&&i.Instance.raiseResizeEvent(t,e)};raiseRenderEvent=()=>{var t,e;null!=this.activeStageName&&(t=this.stages[this.activeStageName])&&(e=$1S.Renderer.Graphics.getContext(),t.Instance.raiseRenderEvent(e))};get=()=>{var t=null;return t=null!=this.activeStageName?this.stages[this.activeStageName]:t};destroy=(t=null)=>{t=t||this.activeStageName,this.activeStageName===t&&(this.stages[this.activeStageName].raiseHideStageEvent(),this.activeStageName=null);var e=this.stages[t];if(!e)throw new Error("Stage not found.");e.raiseDisposeEvent(),e.clearProps(),delete this.stages[t]};switchTo=t=>{if(null!=this.activeStageName&&(this.stages[this.activeStageName].Instance.raiseHideStageEvent(),this.stages[this.activeStageName].SavedState=$1S.Renderer.Graphics.getState()),null==t)this.activeStageName=null;else{if(!this.stages[t])throw new Error("Stage not found: "+t);this.activeStageName=t,null!=this.stages[this.activeStageName].SavedState&&this.stages[this.activeStageName].SavedState&&$1S.Renderer.Graphics.setState(this.stages[this.activeStageName].SavedState),this.stages[this.activeStageName].Instance.raiseShowStageEvent()}};handleTickEvent=(t,e)=>{this.activeStageName&&this.stages[this.activeStageName].Instance.raiseTickEvent(t,e)};handlePostTickEvent=(t,e)=>{this.raiseRenderEvent()};reset=()=>{for(var t=Object.keys(this.stages),e=0;e<this.stagesNames.length;e++)destroy(t[e]);this.stages={},this.activeStageName=null}}var h=new a;return{AlignOnEnum:s,StageType:i,SortByEnum:e,SortByTypes:{ByPriority:{sortOnRegister:!0,sortOnRender:!1,compare:function(t,e){return t.Priority-e.Priority}},ByDepth:{sortOnRegister:!0,sortOnRender:!0,compare:function(t,e){return t.Instance.z-e.Instance.z}}},StagePropType:n,SpritePropType:r,TilesetPropType:o,Ext:h}})(),l.Graphics=(()=>{let i=null,s=null,n=null,r=null,o=!1;return{initialize:(t,e)=>{i=document.getElementById(t),e&&(o=!0,i.width=window.innerWidth,i.height=window.innerHeight),s=i.getContext("2d"),(n=document.createElement("canvas")).width=i.width,n.height=i.height,r=n.getContext("2d"),window.addEventListener("resize",()=>{o&&(i.width=window.innerWidth,i.height=window.innerHeight,s=i.getContext("2d"),(n=document.createElement("canvas")).width=i.width,n.height=i.height,r=n.getContext("2d")),s=i.getContext("2d"),(n=document.createElement("canvas")).width=i.width,n.height=i.height,r=n.getContext("2d"),l.Renderer.Ext.raiseResizeEvent(i.width,i.height)})},setFullScreen:t=>{if(t)i.requestFullscreen?i.requestFullscreen():i.webkitRequestFullscreen?i.webkitRequestFullscreen():i.msRequestFullscreen&&i.msRequestFullscreen(),i.width=screen.width,i.height=screen.height;else{try{document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}catch{}i.width=originalWidth,i.height=originalHeight}s=i.getContext("2d"),(n=document.createElement("canvas")).width=i.width,n.height=i.height,r=n.getContext("2d")},getContext:()=>r,publish:()=>{s.clearRect(0,0,i.width,i.height),s.drawImage(n,0,0)},getState:()=>{return i.toDataURL()},setState:t=>{s.clearRect(0,0,i.width,i.height);const e=new Image;e.onload=function(){s.drawImage(e,0,0)},e.src=t},getStyle:()=>i.style,getSize:()=>({width:i.width,height:i.height})}})(),t.$1S.Renderer={Type:{AlignOn:l.Renderer.AlignOnEnum,SortBy:l.Renderer.SortByEnum,StageType:l.Renderer.StageType,StagePropType:l.Renderer.StagePropType,SpriteType:l.Renderer.SpritePropType,TilesetType:l.Renderer.TilesetPropType},Graphics:{setState:l.Graphics.setState,getState:l.Graphics.getState,getContext:l.Graphics.getContext,getSize:l.Graphics.getSize,getStyle:l.Graphics.getStyle,publish:l.Graphics.publish,setFullScreen:l.Graphics.setFullScreen},register:l.Renderer.Ext.register,render:l.Renderer.Ext.render,destroy:l.Renderer.Ext.destroy,get:l.Renderer.Ext.get,getActiveName:l.Renderer.Ext.getActiveName,switchTo:l.Renderer.Ext.switchTo}})("undefined"!=typeof window?window:global),(t=>{const r={Debug:!0};r.Physics=(()=>{class s{constructor(t,e={}){if(!(t instanceof l))throw new Error("No PhysicsBoundType target provided.");this.id=$1S.Helper.newId(),this.target=t,this.onInit&&this.onInit(e)}onTick(t,e){throw new Error("onTick not implemented.")}}class n{constructor(t,e){if(!(t instanceof l))throw new Error("No PhysicsBoundType target provided.");this.id=$1S.Helper.newId(),this.target=t,this.onInit&&this.onInit(e)}onCollision(t){throw new Error("onCollision not defined.")}}class l extends $1S.Renderer.Type.StagePropType{constructor(t={}){super(t,!0),this.vectorX=t.vectorX||0,this.vectorY=t.vectorY||0,this.rotationSpeed=t.rotationSpeed||0,this.vectorX2=t.vectorX||0,this.vectorY2=t.vectorY||0,this.rotationSpeed2=t.rotationSpeed||0,this.mass=t.mass||1,this.takesCollisions=t.takesCollisions||!1,this.givesCollisions=t.givesCollisions||!1,this.collisionBorder=t.collisionBorder||[],this.physicsModifiers=[],this.collisionModifiers=[],this.collisions=[],this.onInit&&this.onInit(t)}registerPhysicsModifier=(t,e=100)=>{if(!(t instanceof s))throw new Error("Not a PhysicsModifierType component.");this.physicsModifiers.push({Instance:t,Priority:e}),this.physicsModifiers.sort((t,e)=>t.Priority-e.Priority)};getPhysicsModifier=e=>{var t=this.physicsModifiers.find(t=>t.Instance.id===e);return t?t.Instance:null};destroyPhysicsModifier=e=>{var t=this.physicsModifiers.findIndex(t=>t.Instance.id===e);return-1!==t&&(this.physicsModifiers[i].onDestroy&&this.physicsModifiers[i].onDestroy(),this.physicsModifiers.splice(t,1),!0)};clearPhysicsModifiers=()=>{for(var t=0;t<this.physicsModifiers.length;t++)this.physicsModifiers[t].onDestroy&&this.physicsModifiers[t].onDestroy();this.physicsModifiers[t]=[]};registerCollisionModifier=(t,e=100)=>{if(!(t instanceof n))throw new Error("Not a CollisionModifierType component.");this.collisionModifiers.push({Instance:t,Priority:e}),this.collisionModifiers.sort((t,e)=>t.Priority-e.Priority)};getCollisionModifier=e=>{var t=this.collisionModifiers.find(t=>t.Instance.id===e);return t?t.Instance:null};destroyCollisionModifier=e=>{var t=this.collisionModifiers.findIndex(t=>t.Instance.id===e);return-1!==t&&(this.collisionModifiers[i].onDestroy&&this.collisionModifiers[i].onDestroy(),this.collisionModifiers.splice(t,1),!0)};clearCollisionModifiers=()=>{for(var t=0;t<this.collisionModifiers.length;t++)this.collisionModifiers[t].onDestroy&&this.collisionModifiers[t].onDestroy();this.collisionModifiers[t]=[]};raiseTickEvent(t,e){super.raiseTickEvent(t,e);for(var i=0;i<this.physicsModifiers.length;i++)this.physicsModifiers[i].Instance.onTick(t,e);this.x+=this.vectorX*e,this.y+=this.vectorY*e,this.rotation+=this.rotationSpeed*e}raiseResizeEvent=(t,e)=>{super.raiseResizeEvent(t,e);for(var i=0;i<this.physicsModifiers.length;i++)this.physicsModifiers[i].onResize&&this.physicsModifiers[i].Instance.onResize(t,e)};raiseCollisionEvent(t){this.onCollision&&this.onCollision(t),this.vectorX2=this.vectorX,this.vectorY2=this.vectorY,this.rotationSpeed2=this.rotationSpeed;for(var e=0;e<this.collisionModifiers.length;e++)this.collisionModifiers[e].Instance.onCollision(t);for(e=0;e<this.stageProps.length;e++)this.stageProps[e].Instance.raiseCollisionEvent&&this.stageProps[e].Instance.raiseCollisionEvent(t)}raiseCollisionCommitEvent(){this.vectorX=this.vectorX2,this.vectorY=this.vectorY2,this.rotationSpeed=this.rotationSpeed2;for(var t=0;t<this.stageProps.length;t++)stageProps[t].Instance.raiseCollisionCommitEvent&&this.stageProps[t].Instance.raiseCollisionCommitEvent(collisionObjects)}raiseRenderEvent(e=null){if(r.Debug&&this.collisionBorder){var i=$1S.Physics.Collisions.getAbsoluteBorder(this.x,this.y,this.collisionBorder);e.strokeStyle="red",e.lineWidth=1,e.beginPath(),e.moveTo(i[0].x,i[0].y);for(let t=1;t<i.length;t++)e.lineTo(i[t].x,i[t].y);e.closePath(),e.stroke()}super.raiseRenderEvent(e)}}(class{[s](){}});(class{[s](){}});(class{[s](){}});(class{[s](){}});(class{[s](){}});(class{[s](){}});(class{[s](){}});(class{[n](){}});class t extends $1S.Application.ExtensionType{constructor(){super(0)}onLoad=(t,e,i)=>{i()};handlePostTickEvent=(t,e)=>{this.detectCollisions()};detectCollisions=()=>{var t=$1S.Renderer.get();if(t){var e=[],i=t.Instance.stageProps.filter(t=>t.Instance instanceof $1S.Physics.Types.PhysicsBoundType&&t.Instance.givesCollisions);for(const n of t.Instance.stageProps.filter(t=>t.Instance instanceof $1S.Physics.Types.PhysicsBoundType&&t.Instance.takesCollisions)){const r=this.getAbsoluteBorder(n.Instance.x+n.Instance.width/2,n.Instance.y+n.Instance.height/2,n.Instance.collisionBorder),o=i.filter(t=>n.Instance.id!==t.Instance.id).filter(t=>this.doPolygonsIntersect(r,this.getAbsoluteBorder(t.Instance.x+t.Instance.width/2,t.Instance.y+t.Instance.height/2,t.Instance.collisionBorder))).map(t=>t.Instance);var s=o.filter(t=>!n.Instance.collisions.includes(t.id));n.Instance.collisions=[...new Set([...n.Instance.collisions.filter(e=>o.some(t=>t.id===e)),...o.map(t=>t.id)])],0<s.length&&(e.push(n),n.Instance.raiseCollisionEvent(s))}for(const a of e)a.Instance.raiseCollisionCommitEvent()}};getAbsoluteBorder=(e,i,s)=>{var n=[];for(let t=0;t<s.length;t++){var r=e+s[t].x,o=i+s[t].y;n.push({x:r,y:o})}return n};createCollisionBorderBox=(t,e)=>[{x:t/2,y:-e/2},{x:t/2,y:e/2},{x:-t/2,y:e/2},{x:-t/2,y:-e/2}];createCollisionBorderHexagon=(t,e)=>[{x:-(t/2+2),y:0},{x:-(t/4+1),y:e/2+1},{x:t/4+1,y:e/2+1},{x:t/2+2,y:0},{x:t/4+1,y:-(e/2+1)},{x:-(t/4+1),y:-(e/2+1)}];doPolygonsIntersect=(e,i)=>{for(let t=0;t<e.length;t++){var s=e[t],n=t===e.length-1?e[0]:e[t+1];for(let t=0;t<i.length;t++){var r=i[t],o=t===i.length-1?i[0]:i[t+1];if(this.doLinesIntersect(s,n,r,o))return!0}}return!(!this.isPointInsidePolygon(e[0],i)&&!this.isPointInsidePolygon(i[0],e))};doLinesIntersect=(t,e,i,s)=>{const n=e.x-t.x,r=e.y-t.y,o=s.x-i.x,a=s.y-i.y;e=n*a-r*o;return 0!=e&&(s=i.x-t.x,i=i.y-t.y,t=(s*a-i*o)/e,s=(s*r-i*n)/e,0<=t)&&t<=1&&0<=s&&s<=1};isPointInsidePolygon=(i,s)=>{let n=!1;for(let t=0,e=s.length-1;t<s.length;e=t++){var r=s[t],o=s[e];r.y>i.y!=o.y>i.y&&i.x<(o.x-r.x)*(i.y-r.y)/(o.y-r.y)+r.x&&(n=!n)}return n}}var e=new t;return{PhysicsBoundType:l,ThrustModifer:class extends s{onInit(t){this.thrust=t.acceleration,this.speedCap=t.speedCap,this.thrusts={up:!1,down:!1,left:!1,right:!1,forward:!1,backward:!1}}isAccelerating(){return this.thrusts.up||this.thrusts.down||this.thrusts.left||this.thrusts.right||this.thrusts.forward||this.thrusts.backward}moveForwardStart(){this.thrusts.forward=!0}moveBackwardStart(){this.thrusts.backward=!0}moveUpStart(){this.thrusts.up=!0}moveDownStart(){this.thrusts.down=!0}moveLeftStart(){this.thrusts.left=!0}moveRightStart(){this.thrusts.right=!0}moveForwardStop(){this.thrusts.forward=!1}moveBackwardStop(){this.thrusts.backward=!1}moveUpStop(){this.thrusts.up=!1}moveDownStop(){this.thrusts.down=!1}moveLeftStop(){this.thrusts.left=!1}moveRightStop(){this.thrusts.right=!1}onTick(t,e){let i=0;var s,n;this.thrusts.up&&i++,this.thrusts.down&&i++,this.thrusts.left&&i++,this.thrusts.right&&i++,this.thrusts.forward&&i++,this.thrusts.backward&&i++,0<i&&(s=this.thrust/i,this.thrusts.up&&(this.target.vectorY-=s),this.thrusts.down&&(this.target.vectorY+=s),this.thrusts.left&&(this.target.vectorX-=s),this.thrusts.right&&(this.target.vectorX+=s),this.thrusts.forward&&(n=this.target.rotation*(Math.PI/180),this.target.vectorX+=s*Math.cos(n),this.target.vectorY+=s*Math.sin(n)),this.thrusts.backward&&(n=this.target.rotation*(Math.PI/180),this.target.vectorX-=s*Math.cos(n),this.target.vectorY-=s*Math.sin(n)),0<this.speedCap)&&(s=Math.sqrt(this.target.vectorX**2+this.target.vectorY**2))>this.speedCap&&(n=this.speedCap/s,this.target.vectorX*=n,this.target.vectorY*=n)}},EnvironmentalGravityModifier:class extends s{onInit(t){this.gravity=t.gravity,this.direction=t.direction}onTick(t,e){var i=this.direction.x*this.gravity,s=this.direction.y*this.gravity*e;this.target.vectorX+=i*e,this.target.vectorY+=s}},GravitationalAttractionModifier:class extends s{onInit(t){this.gravityConstant=t.gravityConstant}onTick(t,e){for(var i=$1S.Renderer.get(),s=(console.log(i),i.Instance.stageProps),n=0;n<s.length;n++){var r,o,a,h=s[n].Instance;h instanceof l&&(o=h.mass,a=h.x,r=h.y,h.id!==this.target.id)&&(h=a-this.target.x,a=r-this.target.y,0!=(r=Math.sqrt(h*h+a*a)))&&(a=(o=this.gravityConstant*o/r)*a/r,this.target.vectorX+=o*h/r*e,this.target.vectorY+=a*e)}}},FrictionModifier:class extends s{onInit(t){this.friction=t.frictionCoefficient}onTick(t,e){var i=0<this.target.vectorX?-1:1,s=0<this.target.vectorY?-1:1,i=Math.abs(this.target.vectorX)*this.friction*e*i,e=Math.abs(this.target.vectorY)*this.friction*e*s;Math.abs(i)>Math.abs(this.target.vectorX)?this.target.vectorX=0:this.target.vectorX+=i,Math.abs(e)>Math.abs(this.target.vectorY)?this.target.vectorY=0:this.target.vectorY+=e}},BounceModifier:class extends s{onInit(t){this.width=t.width,this.height=t.height,this.bounceReduction=t.bounceReduction}onTick(t,e){this.target.x-this.target.width/2<0?(this.target.x=this.target.width/2,this.target.vectorX=-this.target.vectorX):this.target.x+this.target.width/2>this.width&&(this.target.x=this.width-this.target.width/2,this.target.vectorX=-this.target.vectorX),this.target.y-this.target.height/2<0?(this.target.y=this.target.height/2,this.target.vectorY=-this.target.vectorY):this.target.y+this.target.height/2>this.height&&(this.target.y=this.height-this.target.height/2,this.target.vectorY=-this.target.vectorY+this.bounceReduction,0<this.target.vectorY)&&(this.target.vectorY=0)}},WrapAroundModifier:class extends s{onInit(t){this.width=t.width,this.height=t.height}onTick(t,e){this.target.x<-this.target.width/2?this.target.x=this.width+this.target.width/2:this.target.x>this.width+this.target.width/2&&(this.target.x=-this.target.width/2),this.target.y<-this.target.height/2?this.target.y=this.height+this.target.height/2:this.target.y>this.height+this.target.height/2&&(this.target.y=-this.target.height/2)}},RotateTowardsVectorModifier:class extends s{onInit(t){this.active=!0,this.rotationSpeed=t.rotationSpeed}onTick(t,e){var i;this.active&&(i=180*Math.atan2(this.target.vectorY,this.target.vectorX)/Math.PI,this.target.rotationSpeed=0,this.target.rotation=i)}},BounceCollision:class extends n{onCollision(e){for(let t=0;t<e.length;t++){var i=e[t],s=this.target.mass+i.mass,n=(this.target.mass-i.mass)/s*this.target.vectorX2+2*i.mass/s*i.vectorX,s=(this.target.mass-i.mass)/s*this.target.vectorY2+2*i.mass/s*i.vectorY;this.target.vectorX2=n,this.target.vectorY2=s}}},Ext:e}})(),t.$1S.Physics={Types:{PhysicsBoundType:r.Physics.PhysicsBoundType},Motion:{Thrust:r.Physics.ThrustModifer,Friction:r.Physics.FrictionModifier,EnvironmentalGravity:r.Physics.EnvironmentalGravityModifier,GravitationalAttraction:r.Physics.GravitationalAttractionModifier,Bounce:r.Physics.BounceModifier,WrapAround:r.Physics.WrapAroundModifier,RotateTowardsVector:r.Physics.RotateTowardsVectorModifier},Collisions:{Modifiers:{Bounce:r.Physics.BounceCollision},createBox:r.Physics.Ext.createCollisionBorderBox,createHexagon:r.Physics.Ext.createCollisionBorderHexagon,getAbsoluteBorder:r.Physics.Ext.getAbsoluteBorder},Spacial:{doPolygonsIntersect:r.Physics.Ext.doPolygonsIntersect,doLinesIntersect:r.Physics.Ext.doLinesIntersect,isPointInsidePolygon:r.Physics.Ext.doPolygonsOverlap}}})("undefined"!=typeof window?window:global),(t=>{var e={};e.UI=(()=>{class s extends $1S.Renderer.Type.StagePropType{constructor(t={}){super(t),this.backColor=t.backColor||"transparent",this.textColor=t.textColor||"black",this.fontSize=t.fontSize||16,this.fontFamily=t.fontFamily||"Arial",this.textAlign=t.textAlign||"left",this.isFocused=!1,this.onInit&&this.onInit(t)}registerProp=(t,e=0,i=0)=>{if(!(t instanceof s))throw new Error("Not a UiType component.");super.registerProp(t,{},i+1e5)};onDraw(t){t.clearRect(0,0,this.width,this.height),t.fillStyle=this.backColor,t.fillRect(0,0,this.width,this.height)}}(class{[s](){}});(class{[s](){}});(class{[s](){}});class t extends $1S.Application.ExtensionType{constructor(){super(0)}onLoad=(t,e,i)=>{i()};onTick=(t,e)=>{throw new Error("onTick not implemented")}}var e=new t;return{UiType:s,MoveToModifer:class{constructor(t){this.target=t,this.speed=0,this.milliSeconds=0,this.startX=0,this.startY=0,this.targetX=0,this.targetY=0,this.callback=null}onRender(t){}moveToPosition(t,e,i,s){this.startX=this.target.x,this.startY=this.target.y,this.targetX=t,this.targetY=e,this.milliSeconds=i;t=Math.sqrt((t-this.target.x)**2+(e-this.target.y)**2);this.speed=t/i,this.callback=s}onTick(t,e){var i,s,n;this.target.x==this.targetX&&this.target.y==this.targetY||(e=e,i=this.targetX-this.target.x,n=this.targetY-this.target.y,0<(s=Math.sqrt(i**2+n**2))&&(s<=(e=this.speed*e)?(this.target.x=this.targetX,this.target.y=this.targetY,this.speed=0,this.callback&&this.callback()):(n=n/s*e,this.target.x+=i/s*e,this.target.y+=n)))}},LabelControl:class extends s{onInit(t){this.text=t.text||""}onDraw(t){var e;super.onDraw(t),t.font=this.fontSize+"px "+this.fontFamily,t.fillStyle=this.textColor,t.textBaseline="middle","center"==this.textAlign?(e=t.measureText(this.text).width,t.fillText(this.text,(this.width-e)/2,this.height/2,this.width)):"right"==this.textAlign?(e=t.measureText(this.text).width,t.fillText(this.text,this.width-e,this.height/2,this.width)):t.fillText(this.text,0,this.height/2,this.width)}},TextBoxControl:class extends s{onInit(t){this.text=t.text||"",this.isEditable=void 0===t.isEditable||t.isEditable,this.cursorPosition=0,this.cursorBlinkInterval=null,this.cursorVisible=!1,this.cursorColor=t.cursorColor||"black",this.region=this.getRegion()}onShowStage(){var t=this.region;$1S.IO.Input.attach($1S.IO.Input.EventType.MOUSE_MOVE,this.id,t=>($1S.Renderer.Graphics.getStyle().cursor="pointer",!0),100,t),$1S.IO.Input.attach($1S.IO.Input.EventType.MOUSE_ENTER,this.id,t=>($1S.Renderer.Graphics.getStyle().cursor="pointer",!0),100,t),$1S.IO.Input.attach($1S.IO.Input.EventType.MOUSE_LEAVE,this.id,t=>($1S.Renderer.Graphics.getStyle().cursor="default",!0),100,t),$1S.IO.Input.attach($1S.IO.Input.EventType.MOUSE_CLICK,this.id,t=>(this.isFocused=!0,this.setCursorPosition(t.offsetX),this.startCursorBlinking(),!0),100,t),$1S.IO.Input.attach($1S.IO.Input.EventType.TAP,this.id,t=>(this.isFocused=!0,this.setCursorPosition(t.offsetX),this.startCursorBlinking(),!0),100,t),$1S.IO.Input.attach($1S.IO.Input.EventType.MOUSE_CLICK_OUT,this.id,t=>(this.isFocused=!1,this.stopCursorBlinking(),!0),100,t),$1S.IO.Input.attach($1S.IO.Input.EventType.TAP_OUT,this.id,t=>(this.isFocused=!1,this.stopCursorBlinking(),!0),100,t),$1S.IO.Input.attach($1S.IO.Input.EventType.KEY_DOWN,this.id,t=>{if(this.isEditable&&this.isFocused)switch(t.preventDefault(),t.keyCode){case 8:0<this.cursorPosition&&(this.text=this.text.slice(0,this.cursorPosition-1)+this.text.slice(this.cursorPosition),this.cursorPosition--);break;case 46:this.cursorPosition<this.text.length&&(this.text=this.text.slice(0,this.cursorPosition)+this.text.slice(this.cursorPosition+1));break;case 37:0<this.cursorPosition&&this.cursorPosition--;break;case 39:this.cursorPosition<this.text.length&&this.cursorPosition++;break;default:1===t.key.length&&(this.text=this.text.slice(0,this.cursorPosition)+t.key+this.text.slice(this.cursorPosition),this.cursorPosition++)}return!0})}onHideStage(){this.onDispose()}onDispose(){$1S.Renderer.Graphics.getStyle().cursor="default",$1S.IO.Input.release(this.id)}onDraw(t){t.clearRect(0,0,this.width,this.height),t.fillStyle=this.backColor,t.fillRect(0,0,this.width,this.height),t.font=this.fontSize+"px "+this.fontFamily,t.fillStyle=this.textColor,t.textBaseline="middle";var e,i,s=t.measureText(this.text),s=s.fontBoundingBoxAscent+s.fontBoundingBoxDescent;t.fillText(this.text,0,this.height/2),this.isEditable&&this.isFocused&&this.cursorVisible&&(e=this.getXPositionForCursorPosition(this.cursorPosition),i=this.height/2-s/2,t.strokeStyle=this.cursorColor,t.beginPath(),t.moveTo(e,i),t.lineTo(e,i+s),t.stroke())}setCursorPosition(t){var e=t-this.region.x1;let i=1/0,s=0;for(let t=0;t<=this.text.length;t++){var n=Math.abs(this.getXPositionForCursorPosition(t)-e);n<i&&(i=n,s=t)}this.cursorPosition=s}getXPositionForCursorPosition(t){t=this.text.slice(0,t);return this.workContext.measureText(t).width}startCursorBlinking(){this.cursorVisible=!0,this.cursorBlinkInterval=setInterval(()=>{this.cursorVisible=!this.cursorVisible},500)}stopCursorBlinking(){this.isFocused=!1,clearInterval(this.cursorBlinkInterval),this.cursorBlinkInterval=null,this.cursorVisible=!1}},ButtonControl:class extends s{onInit(t){this.text=t.text||"",this.onClickHandler=t.onClick||null,this.state=null,this.stateIsDown=!1}onShowStage(){var t=this.getRegion();$1S.IO.Input.attach($1S.IO.Input.EventType.MOUSE_MOVE,this.id,t=>($1S.Renderer.Graphics.getStyle().cursor="pointer",!0),100,t),$1S.IO.Input.attach($1S.IO.Input.EventType.MOUSE_ENTER,this.id,t=>($1S.Renderer.Graphics.getStyle().cursor="pointer",!0),100,t),$1S.IO.Input.attach($1S.IO.Input.EventType.MOUSE_LEAVE,this.id,t=>($1S.Renderer.Graphics.getStyle().cursor="default",!0),100,t),$1S.IO.Input.attach($1S.IO.Input.EventType.MOUSE_CLICK,this.id,t=>(this.state="down",this.onClickHandler&&(this.clickTimeout&&clearTimeout(this.clickTimeout),this.clickTimeout=setTimeout(()=>{this.onClickHandler(this),this.clickTimeout=null},100)),!0),100,t),$1S.IO.Input.attach($1S.IO.Input.EventType.TAP,this.id,t=>(this.onClickHandler&&(this.clickTimeout&&clearTimeout(this.clickTimeout),this.clickTimeout=setTimeout(()=>{this.onClickHandler(this),this.clickTimeout=null},100)),!0),100,t),$1S.IO.Input.attach($1S.IO.Input.EventType.MOUSE_UP,this.id,t=>(this.stateIsDown&&(this.state="up"),!0),100,t)}onHideStage(){this.onDispose()}onDraw(t){super.onDraw(t),t.font=this.fontSize+"px "+this.fontFamily,t.fillStyle=this.textColor,t.textBaseline="middle","down"==this.state?(this.x+=2,this.y+=2,this.state=null,this.stateIsDown=!0):"up"==this.state&&(this.x-=2,this.y-=2,this.state=null,this.stateIsDown=!1);var e=t.measureText(this.text).width;t.fillText(this.text,(this.width-e)/2,this.height/2,this.width)}onDispose(){$1S.Renderer.Graphics.getStyle().cursor="default",$1S.IO.Input.release(this.id)}},Ext:e}})(),t.$1S.UI={UiType:e.UI.UiType,Animate:{moveTo:e.UI.MoveToModifer,fade:e.UI.FadeModifer},Controls:{TextBox:e.UI.TextBoxControl,Button:e.UI.ButtonControl,Label:e.UI.LabelControl}}})("undefined"!=typeof window?window:global);
